FROM golang:1.21-alpine AS builder

# Установка зависимостей
RUN apk add --no-cache git

WORKDIR /app

# Копируем go mod файлы
COPY go.mod go.sum ./

# Скачиваем зависимости
RUN go mod download

# Копируем исходный код
COPY . .

# Устанавливаем air для hot reload
RUN go install github.com/cosmtrek/air@latest

# Финальный образ
FROM golang:1.21-alpine

RUN apk add --no-cache git

WORKDIR /app

# Копируем air из builder
COPY --from=builder /go/bin/air /usr/local/bin/air

# Копируем исходный код
COPY . .

# Запускаем air для разработки
CMD ["air", "-c", ".air.toml"]
